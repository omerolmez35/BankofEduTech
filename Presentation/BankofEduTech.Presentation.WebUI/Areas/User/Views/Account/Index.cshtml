@using BankofEduTech.Core.Application.Features.Queries.AppUser.GetUserByName
@model GetUserByNameQueryResponse
@{
    ViewData["Title"] = "Profil - Bank Of EduTech";
    Layout = "~/Views/UserLayout/Index.cshtml";
}
<div class="page-title">
    <div class="row">
        <div class="col-12 col-md-6 order-md-1 order-last">
            <h3>Profil</h3>
        </div>
        <div class="col-12 col-md-6 order-md-2 order-first">
            <nav aria-label="breadcrumb" class="breadcrumb-header float-start float-lg-end">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/User/Home/Index">Anasayfa</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Profil</li>
                </ol>
            </nav>
        </div>
    </div>
</div>

<div class="col-md-6 col-12">
    <div class="card">
        <div class="card-header">
            <h4 class="card-title">Profil Bilgileri</h4>
        </div>
        <div class="card-content">
            <div class="card-body">

                <div class="form-body">
                    <div class="row">
                        <div class="col-md-4">
                            <label>Ad</label>
                        </div>
                        <div class="col-md-8">
                            <div class="form-group has-icon-left">
                                <div class="position-relative">
                                    <input type="text" value="@Model.Name" id="Name" class="form-control"
                                           placeholder="Ad" id="first-name-icon">
                                    <div class="form-control-icon">
                                        <i class="bi bi-person"></i>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <label>Soyad</label>
                        </div>
                        <div class="col-md-8">
                            <div class="form-group has-icon-left">
                                <div class="position-relative">
                                    <input type="text" value="@Model.Surname" id="Surname" class="form-control"
                                           placeholder="Soyad" id="first-name-icon">
                                    <div class="form-control-icon">
                                        <i class="bi bi-person"></i>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <label>İl</label>
                        </div>
                        <div class="col-md-8">
                            <div class="form-group has-icon-left">
                                <div class="position-relative">
                                    <input type="text" value="@Model.City" id="City" class="form-control"
                                           placeholder="İl" id="first-name-icon">
                                    <div class="form-control-icon">
                                        <i class="bi bi-person"></i>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <label>İlçe</label>
                        </div>
                        <div class="col-md-8">
                            <div class="form-group has-icon-left">
                                <div class="position-relative">
                                    <input type="text" value="@Model.District" id="District" class="form-control"
                                           placeholder="İlçe" id="first-name-icon">
                                    <div class="form-control-icon">
                                        <i class="bi bi-person"></i>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <div class="col-md-4">
                            <label>Email</label>
                        </div>
                        <div class="col-md-8">
                            <div class="form-group has-icon-left">
                                <div class="position-relative">
                                    <input type="email" id="Email" value="@Model.Email" class="form-control"
                                           placeholder="Email" id="first-name-icon">
                                    <div class="form-control-icon">
                                        <i class="bi bi-envelope"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label>Telefon</label>
                        </div>
                        <div class="col-md-8">
                            <div class="form-group has-icon-left">
                                <div class="position-relative">
                                    <input type="number" value="@Model.PhoneNumber" id="PhoneNumber" class="form-control"
                                           placeholder="Telefon">
                                    <div class="form-control-icon">
                                        <i class="bi bi-phone"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label>Şifre</label>
                        </div>
                        <div class="col-md-8">
                            <div class="form-group has-icon-left">
                                <div class="position-relative">
                                    <input type="password" class="form-control" id="Password"
                                           placeholder="Şifre">
                                    <div class="form-control-icon">
                                        <i class="bi bi-lock"></i>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <label>Şifre Tekrar</label>
                        </div>
                        <div class="col-md-8">
                            <div class="form-group has-icon-left">
                                <div class="position-relative">
                                    <input type="password" class="form-control" id="ConfirmPassword"
                                           placeholder="Şifre Tekrar">
                                    <div class="form-control-icon">
                                        <i class="bi bi-lock"></i>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-12 d-flex justify-content-end">
                            <button onclick="updateUser()"
                                    class="btn btn-primary me-1 mb-1">
                                Güncelle
                            </button>
                            <button type="reset"
                                    class="btn btn-light-secondary me-1 mb-1">
                                Reset
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<script>
    function updateUser() {

        var data = {
            Name: document.getElementById("Name").value,
            Surname: document.getElementById("Surname").value,
            City: document.getElementById("City").value,
            District: document.getElementById("District").value,
            Email: document.getElementById("Email").value,
            PhoneNumber: document.getElementById("PhoneNumber").value,
            Password: document.getElementById("Password").value,
            ConfirmPassword: document.getElementById("ConfirmPassword").value
        };

        if ((data.Password != "" || data.Password != null) && data.Password != data.ConfirmPassword) {
            Swal.fire({
                icon: "error",
                title: "Hata...",
                text: "Şifreler uyuşmuyor!"

            });
        }
        else {
            $.ajax({
                type: "POST",
                url: "/User/Account/Index", 
                contentType: "application/json", 
                data: JSON.stringify(data), 
                success: function (result) {
                    console.log(result);
                    if (result.isSuccess == true) {
                        Swal.fire({
                            title: "İşlem başarılı!",
                            text: "Kuıllanıcı bilgileri başarıyla güncellendi!",
                            icon: "success"
                        });

                    }
                    else {
                        var error = "";
                        result.messages.forEach(function (element) {
                            error += element + " <br>";
                        });
                        console.log(error);
                        Swal.fire({
                            icon: "error",
                            title: "Hata...",
                            html: error

                        });
                    }

                },
                error: function (xhr, status, error) {
                    Swal.fire({
                        icon: "error",
                        title: "Hata...",
                        html: error

                    });
                }
            });
        }
    }
</script>